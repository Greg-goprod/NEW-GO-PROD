# ğŸ“Š Graphique d'Ã‰volution Spotify - Documentation

## ğŸ¯ **CE QUI A Ã‰TÃ‰ IMPLÃ‰MENTÃ‰**

Un systÃ¨me complet de suivi historique des donnÃ©es Spotify avec visualisation graphique.

---

## ğŸ“ **OÃ™ SE TROUVE LE GRAPHIQUE ?**

### Navigation
```
App > Artistes > [Cliquer sur un artiste] > Page dÃ©tail
```

### Position dans la page
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Photo de l'artiste                     â”‚
â”‚  Widget Spotify                         â”‚
â”‚  Contact                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Statistiques Spotify                â”‚
â”‚  â€¢ Followers: 4,232,782                 â”‚
â”‚  â€¢ PopularitÃ©: 71/100                   â”‚
â”‚  â€¢ Genres: Pop, Rock                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ˆ Ã‰volution Spotify                   â”‚ â† ICI !
â”‚                                         â”‚
â”‚  [7j] [1m] [3m] [6m] [1an] [2ans] [Tout]â”‚
â”‚                                         â”‚
â”‚     5M â”¤              â•±â”â”â”â”â”â”â”          â”‚
â”‚        â”‚         â•±â”â”â”â”â•±                 â”‚
â”‚     4M â”¤    â•±â”â”â”â”â•±                      â”‚
â”‚        â”‚â”â”â”â”â•±                           â”‚
â”‚     3M â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚        Sep   Oct   Nov   DÃ©c   Jan      â”‚
â”‚                                         â”‚
â”‚  â”â”â” Followers  â”â”â” PopularitÃ©          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ RÃ©seaux sociaux                     â”‚
â”‚  â€¢ Spotify                              â”‚
â”‚  â€¢ Instagram                            â”‚
â”‚  â€¢ Facebook                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ **FONCTIONNALITÃ‰S**

### 1. **SÃ©lecteur de PÃ©riode**

7 options disponibles :

| PÃ©riode | DurÃ©e | Cas d'usage |
|---------|-------|-------------|
| **7 jours** | 1 semaine | Tendance rÃ©cente, pics d'actualitÃ© |
| **1 mois** | 30 jours | Performance mensuelle |
| **3 mois** | 90 jours | Tendance trimestrielle |
| **6 mois** | 180 jours | Ã‰volution semestrielle |
| **1 an** | 365 jours | Performance annuelle |
| **2 ans** | 730 jours | Tendance long terme |
| **Tout** | IllimitÃ© | Historique complet depuis le dÃ©but |

### 2. **Double Ligne**

**Ligne Violette** : Followers
- Axe Y gauche
- Ã‰chelle dynamique (K, M)
- Affiche la croissance de la fanbase

**Ligne Rose** : PopularitÃ©
- Axe Y droit
- Ã‰chelle 0-100
- Mesure l'engagement et l'Ã©coute

### 3. **InteractivitÃ©**

- âœ… **Hover** : Info-bulle avec valeurs exactes
- âœ… **Responsive** : S'adapte Ã  tous les Ã©crans
- âœ… **Dark Mode** : Couleurs optimisÃ©es
- âœ… **Animations** : Transitions fluides

---

## ğŸ”„ **SYNCHRONISATION AUTOMATIQUE**

### Horaire
**Tous les jours Ã  12h00 UTC** (13h Paris hiver, 14h Paris Ã©tÃ©)

### Processus
```
12:00 UTC
  â†“
Edge Function dÃ©clenchÃ©e par Cron Job
  â†“
Pour chaque entreprise:
  Pour chaque artiste avec Spotify ID:
    1. Appel API Spotify
    2. RÃ©cupÃ©ration followers + popularitÃ©
    3. Mise Ã  jour spotify_data (donnÃ©es actuelles)
    4. Insertion spotify_history (historique)
  â†“
DurÃ©e totale: ~30-60 secondes pour 100 artistes
  â†“
Graphiques mis Ã  jour automatiquement
```

### DonnÃ©es enregistrÃ©es
- `followers` : Nombre d'abonnÃ©s Spotify
- `popularity` : Score 0-100 (algorithme Spotify)
- `recorded_at` : Horodatage de la mesure

---

## ğŸ“Š **EXEMPLE DE DONNÃ‰ES**

### Table `spotify_history`

| recorded_at | followers | popularity |
|-------------|-----------|------------|
| 2025-01-20  | 4,230,000 | 70         |
| 2025-01-21  | 4,232,000 | 71         |
| 2025-01-22  | 4,235,500 | 71         |
| 2025-01-23  | 4,232,782 | 71         |

### Graphique rÃ©sultant

```
Followers
4.24M â”¤                        â€¢
      â”‚                    â€¢
4.23M â”¤              â€¢
      â”‚        â€¢
4.22M â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      20  21  22  23  Janvier

PopularitÃ©
72 â”¤
   â”‚              â€¢â”€â”€â”€â€¢â”€â”€â”€â€¢
70 â”¤        â€¢
   â”‚
68 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   20  21  22  23  Janvier
```

---

## ğŸ› ï¸ **FICHIERS IMPLIQUÃ‰S**

### Frontend
```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ artists/
â”‚       â””â”€â”€ ArtistStatsChart.tsx       â† Composant graphique
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ app/
â”‚       â””â”€â”€ artistes/
â”‚           â””â”€â”€ detail.tsx             â† IntÃ©gration
â””â”€â”€ lib/
    â””â”€â”€ supabaseClient.ts              â† Client Supabase
```

### Backend
```
supabase/
â””â”€â”€ functions/
    â””â”€â”€ spotify_daily_sync/
        â””â”€â”€ index.ts                   â† Edge Function
```

### Base de donnÃ©es
```
Tables:
â”œâ”€â”€ spotify_history                    â† Historique complet
â”œâ”€â”€ spotify_data                       â† DonnÃ©es actuelles
â””â”€â”€ artists                            â† Informations artistes

Views:
â”œâ”€â”€ spotify_stats_with_change          â† Vue avec variations
â””â”€â”€ latest_spotify_history             â† DerniÃ¨res entrÃ©es

Cron Jobs:
â””â”€â”€ spotify-daily-sync                 â† Synchronisation quotidienne
```

---

## ğŸ¯ **CAS D'USAGE**

### 1. **Analyser une Campagne Marketing**

**ScÃ©nario** : Sortie d'album le 15/01

**Action** :
1. SÃ©lectionner **1 mois**
2. Observer le pic de followers vers le 15/01
3. Mesurer l'impact : +50,000 followers en 7 jours

### 2. **Comparer les Artistes**

**ScÃ©nario** : Qui a la meilleure croissance ?

**Action** :
1. Ouvrir plusieurs onglets avec diffÃ©rents artistes
2. SÃ©lectionner **3 mois** partout
3. Comparer visuellement les courbes

### 3. **DÃ©tecter un ProblÃ¨me**

**ScÃ©nario** : Chute soudaine de popularitÃ©

**Action** :
1. SÃ©lectionner **7 jours**
2. Identifier la date exacte de la chute
3. Investiguer les causes (scandale, retrait de morceau, etc.)

### 4. **Planifier une StratÃ©gie**

**ScÃ©nario** : Budget marketing annuel

**Action** :
1. SÃ©lectionner **1 an** ou **2 ans**
2. Identifier les pÃ©riodes de forte croissance
3. Reproduire les stratÃ©gies gagnantes

---

## ğŸ“ˆ **MÃ‰TRIQUES DISPONIBLES**

### Followers (AbonnÃ©s)
- **DÃ©finition** : Nombre d'utilisateurs qui suivent l'artiste sur Spotify
- **Importance** : Mesure la taille de la fanbase
- **Tendance** : GÃ©nÃ©ralement en croissance constante
- **Pic typique** : +20-50% lors d'une sortie d'album majeure

### Popularity (PopularitÃ©)
- **DÃ©finition** : Score 0-100 calculÃ© par Spotify (algorithme propriÃ©taire)
- **Facteurs** : Nombre d'Ã©coutes rÃ©centes, tendances actuelles
- **Importance** : Mesure l'engagement et la visibilitÃ©
- **VariabilitÃ©** : Fluctue plus que les followers (dÃ©pend des sorties)

---

## ğŸ”§ **MAINTENANCE**

### ZÃ©ro Maintenance Requise âœ…

Le systÃ¨me fonctionne de maniÃ¨re autonome :

- âœ… Synchronisation automatique quotidienne
- âœ… Gestion des erreurs intÃ©grÃ©e (retry, skip)
- âœ… Pas de limite de stockage (PostgreSQL)
- âœ… Pas de coÃ»t API Spotify (client credentials gratuit)
- âœ… Logs dÃ©taillÃ©s pour debugging

### VÃ©rifications Optionnelles

**Hebdomadaire** (optionnel) :
```sql
-- Voir le dernier dÃ©clenchement du cron
SELECT * FROM cron.job_run_details
WHERE jobid = (SELECT jobid FROM cron.job WHERE jobname = 'spotify-daily-sync')
ORDER BY start_time DESC
LIMIT 1;
```

**Mensuelle** (optionnel) :
```sql
-- Compter les entrÃ©es historiques
SELECT COUNT(*) FROM spotify_history;

-- Devrait augmenter de ~80-100 par jour
-- (nombre d'artistes avec Spotify ID)
```

---

## ğŸ¨ **PERSONNALISATION**

### Changer les Couleurs

Fichier : `src/components/artists/ArtistStatsChart.tsx`

```tsx
// Ligne ~120 : Followers
borderColor: 'rgb(139, 92, 246)',      // Violet-400
backgroundColor: 'rgba(139, 92, 246, 0.1)',

// Ligne ~135 : PopularitÃ©
borderColor: 'rgb(236, 72, 153)',      // Pink-500
backgroundColor: 'rgba(236, 72, 153, 0.1)',
```

### Ajouter des PÃ©riodes

```tsx
// Ligne ~315
const periods: { value: Period; label: string }[] = [
  { value: 14, label: '2 semaines' },  // Ajout
  { value: 7, label: '7 jours' },
  // ...
];
```

### Changer l'Horaire du Cron

```sql
-- Fichier : sql/configure_cron_job.sql
-- Ligne 9
'0 12 * * *',  â†’ '0 6 * * *'  (06h00 UTC)
```

---

## â“ **FAQ**

### Q: Le graphique est vide, pourquoi ?
**R:** Pas encore d'historique. Options :
1. Attendre la 1Ã¨re sync automatique (demain 12h00)
2. DÃ©clencher une sync manuelle (voir `CONFIGURE_CRON_NOW.md`)
3. CrÃ©er des donnÃ©es de test (voir `TEST_SPOTIFY_HISTORY_NOW.md`)

### Q: Peut-on ajouter d'autres mÃ©triques ?
**R:** Oui ! Modifiez l'Edge Function pour rÃ©cupÃ©rer :
- Nombre de playlists
- Top tracks
- Ã‰coutes mensuelles (si disponible via API)

### Q: Les donnÃ©es sont-elles fiables ?
**R:** Oui, elles viennent directement de l'API Spotify officielle.

### Q: Quelle est la rÃ©tention des donnÃ©es ?
**R:** IllimitÃ©e ! Toutes les mesures quotidiennes sont conservÃ©es.

### Q: Peut-on exporter les donnÃ©es ?
**R:** Oui :
```sql
COPY (
  SELECT * FROM spotify_history
  WHERE artist_id = 'UUID'
) TO '/tmp/export.csv' CSV HEADER;
```

---

## ğŸ‰ **RÃ‰SUMÃ‰**

âœ… **Graphique interactif** avec 2 lignes (Followers + PopularitÃ©)
âœ… **7 pÃ©riodes** : 7j, 1m, 3m, 6m, 1an, 2ans, tout
âœ… **Synchronisation automatique** quotidienne Ã  12h00 UTC
âœ… **Historique illimitÃ©** depuis le dÃ©ploiement
âœ… **Design moderne** adaptÃ© dark/light mode
âœ… **Position idÃ©ale** entre Stats Spotify et RÃ©seaux sociaux
âœ… **ZÃ©ro maintenance** requise

**Tout est prÃªt ! Il ne reste qu'Ã  configurer le Cron Job.** ğŸš€

Voir : `CONFIGURE_CRON_NOW.md` pour les derniÃ¨res Ã©tapes.



